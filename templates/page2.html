<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼íƒë‹´ë³´ëŒ€ì¶œ ì‹ ì²­ - 2ë‹¨ê³„</title>
  <link rel="stylesheet" href="../static/style_2.css">
  <link rel="stylesheet" href="../static/chat.css">
</head>
<body>
  <div class="page">
    <div class="main-card">

      <!-- ìƒë‹¨ í—¤ë” -->
      <div class="header">
        <h1>ì£¼íƒë‹´ë³´ëŒ€ì¶œ ì‹ ì²­</h1>
        <p>í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
      </div>

      <!-- ì§„í–‰ë¥  -->
      <div class="progress-section">
        <div class="progress-info">
          <span>ì§„í–‰ë¥ </span>
          <span class="step">2/3 ë‹¨ê³„</span>
        </div>

        <div class="progress-bar">
          <div class="bar-fill" style="width: 50%;"></div>
        </div>

        <div class="step-tabs">
          <div class="tab">ëŒ€ì¶œ ì •ë³´</div>
          <div class="tab activate">ë‹´ë³´ ì •ë³´</div>
          <div class="tab">ì†Œë“ ë° ìê²©</div>
        </div>
      </div>

      <!-- ì…ë ¥ íŒì—… -->
      <div class="popup">

        <!-- ì£¼íƒ ê°€ê²© -->
        <div class="form-group">
          <label for="housePrice">ğŸ¢ ì£¼íƒê°€ê²©</label>
            <p class="info">â€» KBì‹œì„¸, ê°ì •í‰ê°€ì•¡ ë“±ì„ ì°¸ê³ í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
          <input type="number" id="housePrice" placeholder="ì˜ˆ: 50000">

          <div class="preset-amounts">
            <button type="button" onclick="setPrice(300000000)">3ì–µì›</button>
            <button type="button" onclick="setPrice(500000000)">5ì–µì›</button>
            <button type="button" onclick="setPrice(700000000)">7ì–µì›</button>
            <button type="button" onclick="setPrice(1000000000)">10ì–µì›</button>
          </div>

        </div>


        <!-- ì£¼íƒ ì†Œì¬ì§€ -->
         <div class="form-group">
          <label for="houseAddress">ğŸ“ ì£¼íƒ ì†Œì¬ì§€</label>
          <input id="houseAddress" type="text" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬">
        </div>

        <!-- ë‹´ë³´ ì¢…ë¥˜ -->
        <div class="form-group">
          <label>ğŸ¢ ë‹´ë³´ ì¢…ë¥˜</label>

          <div class="preset-amounts">
            <button type="button" class="coll-btn" data-value="ì•„íŒŒíŠ¸">
              <span class="title">ì•„íŒŒíŠ¸</span>
              <span class="subtitle">ì•„íŒŒíŠ¸</span>
            <button type="button" class="coll-btn" data-value="ì•„íŒŒíŠ¸ ì™¸">
              <span class="title">ì•„íŒŒíŠ¸ ì™¸</span>
              <span class="subtitle">ë‹¨ë…/ë‹¤ê°€êµ¬/ì—°ë¦½/ë¹Œë¼ ë“± í¬í•¨</span>
            </button>
          </div>

        </div>

        <!-- ì´ì „ / ë‹¤ìŒ ë²„íŠ¼ -->
        <div class="nav-buttons">
          <button type="button" class="btn-prev" onclick="window.location.href='/page1'">ì´ì „</button>
          <button type="button" class="btn-next" onclick="submitPage2()">ë‹¤ìŒ</button>
        </div>

        <!-- ì±—ë´‡ ë²„íŠ¼ -->
        <div class="help-icon" id="chatBtn"></div>

        <!-- ì±—ë´‡ íŒì—… -->
        <div class="chat-panel" id="chatPanel">
          <div class="chat-header">
            <span>ëŒ€ì¶œ ìƒë‹´</span>
            <button id="closeChat" style="background:none;border:none;font-size:18px;cursor:pointer;">Ã—</button>
          </div>

          <div class="chat-body" id="chatBody">
            <div class="msg ai">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
          </div>

          <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button id="sendChat">ì „ì†¡</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="/static/chat.js"></script>
  <script>
    function setPrice(v) {
    document.getElementById('housePrice').value = v;
  }

  // âœ” ë‹´ë³´ ë²„íŠ¼ í´ë¦­ ì‹œ ì„ íƒ ê¸°ëŠ¥
  document.querySelectorAll('.coll-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      // ëª¨ë“  ë²„íŠ¼ active ì œê±°
      document.querySelectorAll('.coll-btn').forEach(b =>
        b.classList.remove('active')
      );

      // í˜„ì¬ í´ë¦­í•œ ë²„íŠ¼ì— active ì¶”ê°€
      btn.classList.add('active');

      // âœ” ì„ íƒëœ ë‹´ë³´ íƒ€ì… í™•ì¸ (í…ŒìŠ¤íŠ¸ìš©)
      console.log("ì„ íƒí•œ ë‹´ë³´ íƒ€ì…:", btn.dataset.value);
    });
  });

  async function submitPage2() {
    const housePrice = document.getElementById("housePrice").value;
    const houseAddress = document.getElementById("houseAddress").value;
    const collateralBtn = document.querySelector(".coll-btn.active");

    if (!housePrice) {
      alert("ì£¼íƒ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
      return;
    }
    if (!houseAddress) {
      alert("ì£¼íƒ ì†Œì¬ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
      return;
    }
    if (!collateralBtn) {
      alert("ë‹´ë³´ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
      return;
    }

    // âœ” ì„ íƒí•œ ë‹´ë³´ ë²„íŠ¼ì˜ value ê°€ì ¸ì˜¤ê¸°
    const collateralType = collateralBtn.dataset.value;

    const payload = {
      housePrice: parseInt(housePrice),
      houseAddress: houseAddress,
      collateralType: collateralType
    };

    console.log("ì „ì†¡ ë°ì´í„°:", payload);

    // FastAPI API í˜¸ì¶œ
    await fetch("/api/page2", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
    window.location.href = "/page3";
  }
  </script>

</body>
</html>
